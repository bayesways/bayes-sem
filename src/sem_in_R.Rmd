---
title: "Factor Models in R"
author: "Konstantinos Vamvourellis"
date: "10/23/2019"
output:
  html_document:
    df_print: paged
    fig_caption: yes
    fig_height: 10
    fig_width: 10
    number_sections: no
    theme: lumen
    toc: yes
    toc_depth: 1
    toc_float: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(readr)
library(dplyr)
```
## Load data

```{r}
df<- read_csv("../dat/muthen_women.csv")
names(df) <- paste0('x', seq(1:15))
glimpse(df)
```

## CFA with `lavaan`

```{r}
library('lavaan')
model <- ' v1  =~ x1 + x2 + x3 
              v2 =~ x4 + x5 + x6
              v3 =~ x7 + x8 + x9 
              v4 =~ x10 + x11 + x12 
              v5 =~ x13 + x14 + x15 '
fit <- cfa(model, data=df)
summary(fit, fit.measures=TRUE, standardized = T)
```

## Irini's test data

```{r}
df <- read_csv("../dat/clean_sample_iri_data.csv")
names(df) <- c('subj_id', 'subj_flag', paste0('x', seq(1:70)))
glimpse(df)
```


```{r}
df[,c("x1","x2","x3","x4","x5","x6","x7","x8","x9","x10","x11","x12","x13","x14","x15","x16","x17","x18","x19","x20","x21","x22","x23","x24","x25","x26","x27","x28","x29","x30","x31","x32","x33","x34","x35","x36","x37","x38","x39","x40","x41","x42","x43","x44","x45","x46","x47","x48","x49","x50","x51","x52","x53","x54","x55","x56","x57","x58","x59","x60","x61","x62","x63","x64","x65","x66","x67","x68","x69","x70")] <-
lapply(df[,c("x1","x2","x3","x4","x5","x6","x7","x8","x9","x10","x11","x12","x13","x14","x15","x16","x17","x18","x19","x20","x21","x22","x23","x24","x25","x26","x27","x28","x29","x30","x31","x32","x33","x34","x35","x36","x37","x38","x39","x40","x41","x42","x43","x44","x45","x46","x47","x48","x49","x50","x51","x52","x53","x54","x55","x56","x57","x58","x59","x60","x61","x62","x63","x64","x65","x66","x67","x68","x69","x70")], ordered)
data <- df[, 3:72]
data
model <- ' v1  =~ x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11 + x12 + x13 + x14 + x15 + x16 + x17 + x18 + x19 + x20 + x21 + x22 + x23 + x24 + x25 + x26 + x27 + x28 + x29 + x30 + x31 + x32 + x33 + x34 + x35 + x36 + x37 + x38 + x39 + x40 + x41 + x42 + x43 + x44 + x45 + x46 + x47 + x48 + x49 + x50 + x51 + x52 + x53 + x54 + x55 + x56 + x57 + x58 + x59 + x60 + x61 + x62 + x63 + x64 + x65 + x66 + x67 + x68 + x69 + x70' 

fit <- cfa(model, data=data, , ordered=names(data))
summary(fit, fit.measures=TRUE, standardized = T)

```



```{r}
# base R command
# fit<- factanal(df, 5, rotation = 'promax')
# fit
```

